# WorkMirror Agent 配置文件

app:
  name: "workmirror-agent"
  version: "0.1.0"
  log_level: "info" # debug, info, warn, error
  # 日志落盘路径（默认会写入用户目录，无需管理员权限）；相对路径以可执行文件目录为基准。
  # 如需仅输出到 stdout，请不要配置该字段。
  # log_path: "./logs/mirror.log"

# 采集器配置
collector:
  poll_interval_ms: 500 # 窗口轮询间隔 (毫秒)
  min_duration_sec: 3 # 最小记录时长 (秒)，低于此值的窗口切换会被忽略
  buffer_size: 2048 # 事件缓冲区大小
  flush_batch_size: 100 # 批量写入阈值
  flush_interval_sec: 5 # 强制刷新间隔 (秒)
  session_idle_min: 6 # idle >= X 分钟则切分新会话

# Diff 采集配置
diff:
  enabled: true
  watch_paths: [] # 监控的项目目录，为空则不启用
  extensions:
    [
      ".go",
      ".py",
      ".js",
      ".ts",
      ".jsx",
      ".tsx",
      ".vue",
      ".java",
      ".rs",
      ".c",
      ".cpp",
    ]
  buffer_size: 512
  debounce_sec: 2 # 防抖时间（秒）

# 浏览器采集配置
browser:
  enabled: true
  poll_interval_sec: 30 # 轮询间隔（秒）
  history_path: "" # Chrome History 路径（为空则自动检测）

# 存储配置
storage:
  # 建议：安装版默认会将 DB 放在用户目录（无需管理员权限）；
  # 如需自定义，可改成绝对路径或相对路径（相对路径以可执行文件目录为基准）。
  db_path: "./data/workmirror.db"

# AI API 配置
ai:
  # DeepSeek LLM
  deepseek:
    api_key: "${DEEPSEEK_API_KEY}"
    base_url: "https://api.deepseek.com"
    model: "deepseek-chat"

  # SiliconFlow Embedding & Reranker
  siliconflow:
    api_key: "${SILICONFLOW_API_KEY}"
    base_url: "https://api.siliconflow.cn/v1"
    embedding_model: "BAAI/bge-large-zh-v1.5"
    reranker_model: "BAAI/bge-reranker-v2-m3"

# 隐私配置（默认开启：Local-first & Privacy by default）
privacy:
  enabled: true
  # patterns 为正则表达式列表；匹配到的内容会被替换为 "***"。
  # 注意：URL query/fragment 会在 URL 级别默认清空（保留域名与 "/..." 以支持证据链解释）。
  patterns:
    - "(?i)\\b(email|e-mail)\\b[:=]\\s*\\S+"
    - "[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}"
    - "(?i)\\b(password|passwd|pwd)\\b[:=]\\s*\\S+"
    - "(?i)\\b(api[_-]?key|token|access[_-]?token|refresh[_-]?token|secret|authorization)\\b[:=]\\s*\\S+"
